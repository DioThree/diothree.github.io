<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Bon dari WA</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h2, h3 {
            color: #0056b3;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }
        textarea {
            width: 98%;
            height: 200px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: block;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3;
        }
        .tombol-cetak {
            background-color: #28a745;
            margin-top: 10px;
        }
        .tombol-cetak:hover {
            background-color: #218838;
        }
        #outputBon {
            margin-top: 20px;
        }
        .editable {
            background-color: #fffde7;
            font-weight: bold;
            padding: 2px 4px;
            display: inline-block;
            min-width: 50px;
        }
        
        /* --- GAYA CSS BARU UNTUK STRUK --- */
        /* Kontainer utama untuk struk, meniru lebar printer thermal */
        .bon-container {
            font-family: 'Courier New', Courier, monospace; /* Font penting! */
            width: 100%; /* Lebar di layar */
            max-width: 400px; /* Batas lebar maks */
            margin: 0 auto;
            padding: 15px;
            border: 1px dashed #777;
            background: #fff;
            box-sizing: border-box; /* Pastikan padding tidak menambah lebar */
        }
        
        .bon-header {
            text-align: center;
            font-size: 14px;
        }
        .bon-header h4, .bon-header p {
            margin: 0;
            padding: 0;
        }
        .bon-header h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .bon-info {
            font-size: 12px;
            margin-top: 10px;
        }
        
        .bon-customer {
            font-size: 14px;
            font-weight: bold;
            margin: 10px 0;
        }

        .bon-divider {
            border-top: 1px dashed #333;
            margin: 8px 0;
            font-size: 1px; /* Trik agar tidak memakan ruang */
        }
        
        /* Menggunakan Flexbox untuk baris */
        .bon-row {
            display: flex;
            justify-content: space-between; /* Penting untuk alignment */
            font-size: 12px;
            margin-bottom: 3px;
        }
        
        .bon-row.header {
            font-weight: bold;
            border-bottom: 1px solid #333;
            padding-bottom: 3px;
            margin-bottom: 5px;
        }

        /* Kolom-kolom */
        .bon-item-name {
            flex-grow: 1; /* Ambil sisa ruang */
            text-align: left;
            /* word-break: break-word; -- Opsi jika nama terlalu panjang */
        }
        
        .bon-item-qty {
            width: 40px; /* Lebar tetap untuk Qty */
            text-align: center;
            flex-shrink: 0; /* Jangan menyusut */
        }
        
        .bon-item-price {
            width: 80px; /* Lebar tetap untuk Harga */
            text-align: right;
            flex-shrink: 0; /* Jangan menyusut */
        }

        /* Baris untuk Total, Bayar, Kembalian */
        .bon-summary-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .bon-summary-label {
            text-align: left;
        }
        
        .bon-summary-value {
            text-align: right;
            min-width: 80px; /* Samakan dengan kolom harga */
        }

        .bon-footer {
            text-align: center;
            font-size: 13px;
            margin-top: 10px;
        }

        /* --- AKHIR GAYA CSS BARU --- */


        /* ATURAN CETAK (PRINT) */
        @media print {
            body {
                font-family: 'Courier New', Courier, monospace; /* Paksa font cetak */
                font-size: 10pt; /* Ukuran font printer thermal */
            }
            body > * {
                display: none;
            }
            .container {
                display: block;
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
                max-width: 100%;
            }
            .container h2, 
            .container h3, 
            .container #inputWA, 
            .container button {
                display: none; /* Sembunyikan UI */
            }
            #outputBon {
                display: block;
                margin-top: 0;
            }
            
            /* Tampilkan .bon-container secara penuh saat cetak */
            .bon-container {
                width: 100%;
                max-width: 100%; /* Gunakan lebar penuh kertas */
                border: none;
                padding: 0;
            }

            .bon-header {
                font-size: 12pt;
            }
            .bon-header h4 {
                font-size: 14pt;
            }
            .bon-info, .bon-row {
                font-size: 10pt;
            }
            .bon-summary-row, .bon-footer {
                font-size: 11pt;
            }
            
            .editable {
                background-color: #fff !important; /* Hapus latar kuning saat cetak */
                font-weight: normal;
            }
            
            /* Sembunyikan header cetak lama (jika ada) */
            .print-header {
                display: none;
            }
        }
        
    </style>
</head>
<body>

    <div class="container">
        <h2>Generator Bon dari WhatsApp</h2>
        
        <h3>1. Tempel (Paste) Teks dari WA</h3>
        <textarea id="inputWA" placeholder="Tempel teks dari WA di sini... Contoh:&#10;Dio&#10;Bayam 1 ikat&#10;Wortel 2 kg"></textarea>
        
        <button onclick="prosesBon()">Proses Menjadi Bon</button>
        <button class="tombol-cetak" onclick="cetakBon()">Cetak Bon</button>
        
        <h3>2. Hasil Bon (Bisa Diedit)</h3>
        <div id="outputBon">
            <p>Hasil bon akan ditampilkan di sini...</p>
        </div>
    </div>

    <script>
        function prosesBon() {
            // Ambil tanggal hari ini
            const today = new Date();
            const optionsDate = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const formattedDate = today.toLocaleDateString('id-ID', optionsDate);
            const formattedTime = today.toLocaleTimeString('id-ID', optionsTime).replace(/\./g, ':');
            
            const inputText = document.getElementById('inputWA').value;
            const lines = inputText.split('\n');
            
            let customerName = ''; 
            let items = []; 

            // Regex Anda untuk mendeteksi item (sudah bagus)
            const regexItem = /^[^\d]+\d/;

            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine === '') return;
                
                if (regexItem.test(trimmedLine)) {
                    // Ini adalah ITEM
                    const indexAngkaPertama = trimmedLine.search(/\d/);
                    const itemName = trimmedLine.substring(0, indexAngkaPertama).trim();
                    const quantity = trimmedLine.substring(indexAngkaPertama).trim();
                    
                    items.push({ name: itemName, qty: quantity });

                } else {
                    // Ini adalah NAMA PELANGGAN
                    customerName = trimmedLine;
                }
            });
            
            // --- MULAI GENERATE HTML BARU (TANPA TABEL) ---
            
            let outputHTML = '<div class="bon-container">';
            
            // 1. Header Struk (dari gambar)
            outputHTML += `
                <div class="bon-header">
                    <h4>Gudang Sayurr</h4>
                    <p>Jl. Pasar Sehat Sabilulungan No. 28,29,30, Kota Bandung</p>
                    <p>Tera, 14045</p>
                    <p>Telp: 085315828729</p>
                </div>
            `;
            
            // 2. Info Transaksi (Tanggal dari JS, sisanya statis dari gambar)
            outputHTML += `
                <div class="bon-info">
                    <div class="bon-row">
                        <span class="left">Kode Transaksi:</span>
                        <span class="right">TRX23888242</span>
                    </div>
                    <div class="bon-row">
                        <span class="left">Pembayaran:</span>
                        <span class="right">Tunai</span>
                    </div>
                    <div class="bon-row">
                        <span class="left">Tanggal:</span>
                        <span class="right">${formattedDate} ${formattedTime}</span>
                    </div>
                </div>
            `;
            
            // 3. Nama Pelanggan (jika ada)
            if (customerName) {
                outputHTML += `<div class="bon-customer">Pelanggan: ${customerName}</div>`;
            }
            
            // 4. Header Item
            outputHTML += '<div class="bon-divider"></div>';
            outputHTML += `
                <div class="bon-row header">
                    <span class="bon-item-name">Nama Barang</span>
                    <span class="bon-item-qty">Qty</span>
                    <span class="bon-item-price">Harga</span>
                </div>
            `;
            
            // 5. Daftar Item (Loop)
            if (items.length > 0) {
                items.forEach(item => {
                    outputHTML += `
                        <div class="bon-row">
                            <span class="bon-item-name">${item.name}</span>
                            <span class="bon-item-qty">${item.qty}</span>
                            <span class="bon-item-price editable" contenteditable="true"></span>
                        </div>
                    `;
                });
            } else {
                outputHTML += '<p>Tidak ada item...</p>';
            }
            
            // 6. Garis Pemisah
            outputHTML += '<div class="bon-divider"></div>';

            // 7. Ringkasan Total (dari gambar)
            outputHTML += `
                <div class="bon-summary-row">
                    <span class="bon-summary-label">Total</span>
                    <span class="bon-summary-value editable" contenteditable="true"></span>
                </div>
                <div class="bon-summary-row">
                    <span class="bon-summary-label">Nominal Bayar</span>
                    <span class="bon-summary-value editable" contenteditable="true"></span>
                </div>
                <div class="bon-summary-row">
                    <span class="bon-summary-label">Kembalian</span>
                    <span class="bon-summary-value editable" contenteditable="true"></span>
                </div>
            `;

            // 8. Footer
            outputHTML += '<div class="bon-divider"></div>';
            outputHTML += '<div class="bon-footer">Terima Kasih!</div>';
            
            outputHTML += '</div>'; // Tutup .bon-container
            
            document.getElementById('outputBon').innerHTML = outputHTML;
        }
        
        function cetakBon() {
            window.print();
        }
    </script> 

</body>
</html>
